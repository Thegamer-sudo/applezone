---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Clean3DViewer from '../../components/Clean3DViewer.jsx';
import { getAllIphones } from '../../data/iphones.js';

export async function getStaticPaths() {
  const allIphones = getAllIphones();
  
  return allIphones.map(iphone => ({
    params: { id: iphone.id },
    props: { iphone }
  }));
}

const { iphone } = Astro.props;

// Function to map color names to hex codes
function getColorHex(colorName) {
  const colorMap = {
    'Black': '#1D1D1F',
    'Space Black': '#1D1D1F',
    'White': '#F5F5F7',
    'Silver': '#E4E4E6',
    'Space Gray': '#535150',
    'Graphite': '#535150',
    'Blue': '#007AFF',
    'Pacific Blue': '#007AFF',
    'Sierra Blue': '#64D2FF',
    'Deep Purple': '#800080',
    'Purple': '#800080',
    'Green': '#34C759',
    'Midnight Green': '#004953',
    'Yellow': '#FFD60A',
    'Gold': '#FFD700',
    'Coral': '#FF7F50',
    'Red': '#FF3B30',
    'Pink': '#FF2D55',
    'Natural Titanium': '#8E8E93',
    'Blue Titanium': '#5AC8FA',
    'White Titanium': '#F2F2F7'
  };
  
  return colorMap[colorName] || '#1D1D1F';
}

const hexColors = iphone.colors.map(color => getColorHex(color));

// Separate variants by condition
const preOwnedVariants = iphone.variants.filter(v => v.condition === 'PRE OWNED');
const sealedVariants = iphone.variants.filter(v => v.condition === 'SEALED DEVICE');
const brandNewVariants = iphone.variants.filter(v => v.condition === 'BRAND NEW');

// 3D Model paths and positions for specific iPhones
let modelPath = null;
let modelPosition = [0, -0.2, 0]; // Default position (iPhone 11 perfect setting)

// iPhone XR - uses GLB format (finally!)
if (iphone.id === 'iphone-xr') {
    modelPath = '/models/iphone-xr/iphone_xr.glb';
    modelPosition = [0, -0.2, 0]; // Start with iPhone 11's perfect position
}

// iPhone 11 - uses GLB format
if (iphone.id === 'iphone-11') {
    modelPath = '/models/iphone-11/iphone_11.glb';
    modelPosition = [0, -0.2, 0]; // Perfect for iPhone 11
}

// iPhone 11 Pro - uses GLB format
if (iphone.id === 'iphone-11-pro') {
    modelPath = '/models/iphone-11-pro/iphone_11_pro.glb';
    modelPosition = [0, -0.03, 0];// Even higher
}

// iPhone 11 Pro Max - uses GLB format
if (iphone.id === 'iphone-11-pro-max') {
    modelPath = '/models/iphone-11-pro-max/iphone_11_pro_max__gold.glb';
    modelPosition = [0, -0.1, 0]; // Sweet spot between
}

// iPhone 12 - lower it
if (iphone.id === 'iphone-12') {
    modelPath = '/models/iphone-12/iphone_12.glb';
    modelPosition = [0, -6.0, -1.5]; // Step 7
}

// iPhone 13 - uses GLB format
if (iphone.id === 'iphone-13') {
    modelPath = '/models/iphone-13/iphone_13.glb';
    modelPosition = [0, -0.15, 0]; // Start here
}

// iPhone 13 Pro Max - uses GLB format
if (iphone.id === 'iphone-13-pro-max') {
    modelPath = '/models/iphone-13-pro-max/iphone_13_pro_max.glb';
    modelPosition = [0, -0.15, 0]; // Start here
}

// iPhone 12 Pro - uses GLB format
if (iphone.id === 'iphone-12-pro') {
    modelPath = '/models/iphone-12-pro/iphone_12_pro.glb';
    modelPosition = [0, -0.15, -15]; // Way back
}

// iPhone 14 - uses GLB format
if (iphone.id === 'iphone-14') {
    modelPath = '/models/iphone-14/iphone_14.glb';
    modelPosition = [0, -0.15, 0]; // Start here
}

// iPhone 14 Pro - uses GLB format
if (iphone.id === 'iphone-14-pro') {
    modelPath = '/models/iphone-14-pro/iphone_14_pro.glb';
    modelPosition = [0, -0.15, 0]; // Start here
}

// iPhone 14 Pro Max - uses GLB format
if (iphone.id === 'iphone-14-pro-max') {
    modelPath = '/models/iphone-14-pro-max/iphone_14_pro_max.glb';
    modelPosition = [0, -0.15, 0]; // Start here
}

// iPhone 15 - uses GLB format
if (iphone.id === 'iphone-15') {
    modelPath = '/models/iphone-15/iphone_15.glb';
    modelPosition = [0, -0.15, 0]; // Start here
}

// iPhone 15 Pro - uses GLB format
if (iphone.id === 'iphone-15-pro') {
    modelPath = '/models/iphone-15-pro/iphone_15_pro.glb';
    modelPosition = [0, -0.15, 0]; // Start here
}

// iPhone 15 Pro Max - uses GLB format
if (iphone.id === 'iphone-15-pro-max') {
    modelPath = '/models/iphone-15-pro-max/iphone_15_pro_max.glb';
    modelPosition = [0, -0.15, 0]; // Start here
}

// iPhone 16 - uses GLB format
if (iphone.id === 'iphone-16') {
    modelPath = '/models/iphone-16/iphone_16.glb';
    modelPosition = [0, -0.15, 0]; // Start here
}

// iPhone 16 Pro - uses GLB format
if (iphone.id === 'iphone-16-pro') {
    modelPath = '/models/iphone-16-pro/iphone_16_pro.glb';
    modelPosition = [0, -0.15, 0]; // Start here
}

// iPhone 16 Pro Max - uses GLB format
if (iphone.id === 'iphone-16-pro-max') {
    modelPath = '/models/iphone-16-pro-max/iphone_16_pro_max.glb';
    modelPosition = [0, -0.15, 0]; // Start here
}

// iPhone 17 Pro - uses GLB format
if (iphone.id === 'iphone-17-pro') {
    modelPath = '/models/iphone-17-pro/iphone_17_pro.glb';
    modelPosition = [0, -0.15, 0]; // Start here
}

// iPhone 17 Pro Max - uses GLB format
if (iphone.id === 'iphone-17-pro-max') {
    modelPath = '/models/iphone-17-pro-max/iphone_17_pro_max.glb';
    modelPosition = [0, -0.15, 0]; // Start here
}
// Add more iPhones here as you get their 3D models
// if (iphone.id === 'iphone-12') {
//     modelPath = '/models/iphone-12/model.glb';
// }
---

<BaseLayout>
    <!-- Import Poppins font -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        .font-poppins {
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .gradient-button {
            background: linear-gradient(90deg, #8B5CF6 0%, #EC4899 50%, #3B82F6 100%);
            background-size: 200% auto;
            transition: all 0.3s ease;
        }
        
        .gradient-button:hover {
            background-position: right center;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(139, 92, 246, 0.3);
        }
        
        .gradient-border {
            border-image: linear-gradient(90deg, #8B5CF6 0%, #EC4899 50%, #3B82F6 100%) 1;
        }
        
        .gradient-text {
            background: linear-gradient(90deg, #8B5CF6 0%, #EC4899 50%, #3B82F6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
    </style>

    <!-- Breadcrumb -->
    <div class="container mx-auto px-4 pt-28 pb-8">
        <a href="/products" class="text-gray-600 hover:text-gray-900 text-sm font-medium transition-colors flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
            Back to All iPhones
        </a>
    </div>

    <!-- Product Detail -->
    <div class="container mx-auto px-4 pb-20 font-poppins">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-20">
            <!-- Left Column - 3D iPhone Viewer -->
            <div class="flex justify-center">
                <div class="w-full max-w-xl">
                    <div class="glass-card rounded-3xl p-8 shadow-2xl">
                        <Clean3DViewer 
    client:load 
    modelPath={modelPath}
    modelPosition={modelPosition}
/>
                    </div>
                </div>
            </div>

            <!-- Right Column - Details & Pricing -->
            <div class="space-y-16">
                <!-- Title -->
                <div>
                    <h1 class="text-5xl font-bold text-gray-900 mb-6 tracking-tight">{iphone.name}</h1>
                    <div class="h-1 w-24 gradient-border bg-gradient-to-r from-purple-500 to-pink-500 rounded-full"></div>
                </div>

                <!-- Pricing Tables - Sexy Glass Design -->
                <div class="space-y-12">
                    <!-- PRE OWNED -->
                    {preOwnedVariants.length > 0 && (
                        <div class="glass-card rounded-3xl p-10 shadow-2xl">
                            <div class="flex items-center justify-between mb-12">
                                <div>
                                    <h3 class="text-2xl font-bold text-gray-900 mb-2">PRE OWNED</h3>
                                    <p class="text-gray-600 text-sm">Professionally refurbished • 4 months warranty</p>
                                </div>
                                <div class="h-14 w-14 rounded-2xl bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center shadow-inner">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#8B5CF6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                                    </svg>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                {preOwnedVariants.map((variant) => (
                                    <a 
                                        href={`https://wa.me/27796353542?text=${encodeURIComponent(`Hi, I want to purchase the ${iphone.name} (${variant.storage}, ${variant.condition}) for R${variant.price.toLocaleString('en-ZA')}`)}`}
                                        target="_blank"
                                        class="group relative bg-gradient-to-br from-white to-gray-50 rounded-2xl p-8 text-center border border-gray-200 hover:border-purple-300 transition-all duration-300 hover:shadow-xl hover:-translate-y-1"
                                    >
                                        <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-xs font-semibold px-4 py-1 rounded-full">
                                            {variant.storage}
                                        </div>
                                        <div class="text-4xl font-bold text-gray-900 mb-6 mt-4">R{variant.price.toLocaleString('en-ZA')}</div>
                                        <div class="gradient-button inline-flex items-center justify-center rounded-xl text-white px-8 py-4 font-semibold transition-all w-full">
                                            <span>Purchase</span>
                                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="ml-2">
                                                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                                            </svg>
                                        </div>
                                    </a>
                                ))}
                            </div>
                        </div>
                    )}

                    <!-- SEALED DEVICE -->
                    {sealedVariants.length > 0 && (
                        <div class="glass-card rounded-3xl p-10 shadow-2xl">
                            <div class="flex items-center justify-between mb-12">
                                <div>
                                    <h3 class="text-2xl font-bold text-gray-900 mb-2">SEALED DEVICE</h3>
                                    <p class="text-gray-600 text-sm">Factory sealed • Original accessories</p>
                                </div>
                                <div class="h-14 w-14 rounded-2xl bg-gradient-to-br from-green-100 to-emerald-200 flex items-center justify-center shadow-inner">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#10B981" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                    </svg>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                {sealedVariants.map((variant) => (
                                    <a 
                                        href={`https://wa.me/27796353542?text=${encodeURIComponent(`Hi, I want to purchase the ${iphone.name} (${variant.storage}, ${variant.condition}) for R${variant.price.toLocaleString('en-ZA')}`)}`}
                                        target="_blank"
                                        class="group relative bg-gradient-to-br from-white to-gray-50 rounded-2xl p-8 text-center border border-gray-200 hover:border-green-300 transition-all duration-300 hover:shadow-xl hover:-translate-y-1"
                                    >
                                        <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-gradient-to-r from-emerald-500 to-teal-500 text-white text-xs font-semibold px-4 py-1 rounded-full">
                                            {variant.storage}
                                        </div>
                                        <div class="text-4xl font-bold text-gray-900 mb-6 mt-4">R{variant.price.toLocaleString('en-ZA')}</div>
                                        <div class="gradient-button inline-flex items-center justify-center rounded-xl text-white px-8 py-4 font-semibold transition-all w-full">
                                            <span>Purchase</span>
                                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="ml-2">
                                                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                                            </svg>
                                        </div>
                                    </a>
                                ))}
                            </div>
                        </div>
                    )}

                    <!-- BRAND NEW -->
                    {brandNewVariants.length > 0 && (
                        <div class="glass-card rounded-3xl p-10 shadow-2xl">
                            <div class="flex items-center justify-between mb-12">
                                <div>
                                    <h3 class="text-2xl font-bold text-gray-900 mb-2">BRAND NEW</h3>
                                    <p class="text-gray-600 text-sm">Latest model • Direct from manufacturer</p>
                                </div>
                                <div class="h-14 w-14 rounded-2xl bg-gradient-to-br from-blue-100 to-cyan-200 flex items-center justify-center shadow-inner">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#3B82F6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                                    </svg>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 gap-6">
                                {brandNewVariants.map((variant) => (
                                    <a 
                                        href={`https://wa.me/27796353542?text=${encodeURIComponent(`Hi, I want to purchase the ${iphone.name} (${variant.storage}, ${variant.condition}) for R${variant.price.toLocaleString('en-ZA')}`)}`}
                                        target="_blank"
                                        class="group relative bg-gradient-to-br from-white to-gray-50 rounded-2xl p-8 text-center border border-gray-200 hover:border-blue-300 transition-all duration-300 hover:shadow-xl hover:-translate-y-1"
                                    >
                                        <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-gradient-to-r from-blue-500 to-cyan-500 text-white text-xs font-semibold px-4 py-1 rounded-full">
                                            {variant.storage}
                                        </div>
                                        <div class="text-4xl font-bold text-gray-900 mb-6 mt-4">R{variant.price.toLocaleString('en-ZA')}</div>
                                        <div class="gradient-button inline-flex items-center justify-center rounded-xl text-white px-8 py-4 font-semibold transition-all w-full">
                                            <span>Purchase</span>
                                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="ml-2">
                                                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                                            </svg>
                                        </div>
                                    </a>
                                ))}
                            </div>
                        </div>
                    )}
                </div>

                <!-- Included Benefits - Minimal Design -->
                <div class="glass-card rounded-3xl p-10">
                    <h3 class="text-2xl font-bold text-gray-900 mb-10 text-center">What's Included</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div class="text-center space-y-4">
                            <div class="h-16 w-16 rounded-2xl bg-gradient-to-br from-green-100 to-emerald-200 flex items-center justify-center mx-auto shadow-inner">
                                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#10B981" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                                </svg>
                            </div>
                            <div class="font-semibold text-gray-900 text-lg">4 Months Warranty</div>
                        </div>
                        <div class="text-center space-y-4">
                            <div class="h-16 w-16 rounded-2xl bg-gradient-to-br from-blue-100 to-cyan-200 flex items-center justify-center mx-auto shadow-inner">
                                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#3B82F6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <polyline points="12 6 12 12 16 14"></polyline>
                                </svg>
                            </div>
                            <div class="font-semibold text-gray-900 text-lg">4 Months Lay-by</div>
                        </div>
                        <div class="text-center space-y-4">
                            <div class="h-16 w-16 rounded-2xl bg-gradient-to-br from-purple-100 to-pink-200 flex items-center justify-center mx-auto shadow-inner">
                                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#8B5CF6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="1" y="3" width="15" height="13"></rect>
                                    <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon>
                                    <circle cx="5.5" cy="18.5" r="2.5"></circle>
                                    <circle cx="18.5" cy="18.5" r="2.5"></circle>
                                </svg>
                            </div>
                            <div class="font-semibold text-gray-900 text-lg">Free Accessories</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</BaseLayout>